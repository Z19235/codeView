<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å›æ–‡å­ä¸²ç®—æ³•ï¼šManacher vs ä¸­å¿ƒæ‰©å±•</title>
    <style>
        /* --- åŸºç¡€å¸ƒå±€ --- */
        body{font-family:'Segoe UI',sans-serif;padding:20px;text-align:center;background:#f8fafc;color:#333;display:flex;flex-direction:column;align-items:center; min-height: 100vh;}
        .container{background:white;padding:30px;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.08);display:inline-block;max-width:1100px;width:95%; margin-bottom: 40px;}

        /* --- é¡¶éƒ¨æ§åˆ¶ --- */
        .controls-top { margin-bottom: 15px; display: flex; gap: 10px; justify-content: center; align-items: center; flex-wrap: wrap; }
        input.arr-input { padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; width: 220px; text-align: center; font-size: 18px; letter-spacing: 1px;}

        button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; transition: 0.2s; font-weight: 600; display: flex; align-items: center; gap: 5px; }
        .btn-primary { background: #3b82f6; color: white; box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3); }
        .btn-primary:hover { background: #2563eb; }

        /* --- ç®—æ³•åˆ‡æ¢å™¨ --- */
        .algo-switch {
            display: flex; background: #f1f5f9; padding: 4px; border-radius: 8px; margin-bottom: 20px;
            width: fit-content; margin-left: auto; margin-right: auto; border: 1px solid #e2e8f0;
        }
        .algo-btn {
            padding: 8px 24px; border-radius: 6px; border: none; background: transparent;
            color: #64748b; font-weight: 600; cursor: pointer; font-size: 15px; transition: all 0.2s;
        }
        .algo-btn:hover { color: #334155; }
        .algo-btn.active { background: white; color: #3b82f6; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-weight: bold;}

        /* --- æ’­æ”¾æ§åˆ¶ --- */
        .controls-playback { margin-top: 10px; display: flex; gap: 10px; justify-content: center; align-items: center; background: #f8fafc; padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0;}
        .btn-control { background: white; border: 1px solid #cbd5e1; color: #334155; min-width: 40px; justify-content: center; font-size: 18px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);}
        .btn-control:hover { background: #f1f5f9; }
        #progressBar { width: 300px; cursor: pointer; accent-color: #3b82f6; }

        /* --- å¯è§†åŒ–åŒºåŸŸ --- */
        .vis-wrapper {
            overflow-x: auto;
            padding: 65px 20px 60px 20px; /* ç•™è¶³ç©ºé—´ç»™æŒ‡é’ˆ */
            min-height: 200px;
            display: flex; flex-direction: column; align-items: center;
            border: 1px dashed #e2e8f0; border-radius: 8px; margin: 10px 0;
            background: #fff;
        }

        .array-row { display: flex; margin-bottom: 5px; position: relative; }

        /* å•å…ƒæ ¼ */
        .cell-wrapper { display: flex; flex-direction: column; align-items: center; margin: 0 3px; position: relative; width: 42px;}
        .cell {
            width: 42px; height: 42px;
            border: 1px solid #cbd5e1; background: white;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-family: monospace; font-size: 18px;
            border-radius: 6px; z-index: 2;
            transition: background 0.2s, border 0.2s;
        }
        .idx-label { margin-top: 4px; font-size: 10px; color: #94a3b8; }
        .p-val { margin-top: 2px; font-size: 11px; color: #64748b; height: 14px; font-weight: bold; visibility: hidden;}
        .p-val.show { visibility: visible; }

        /* --- é¢œè‰²çŠ¶æ€ --- */
        .bg-i { border: 2px solid #ef4444; box-shadow: 0 0 8px rgba(239, 68, 68, 0.4); z-index: 10; }
        .bg-mirror { background-color: #f3e8ff; border: 2px dashed #9333ea; }
        .bg-match { background-color: #86efac; border-color: #22c55e; }
        .bg-mismatch { background-color: #fca5a5; border-color: #ef4444; }
        .bg-final { background-color: #fde047; border-color: #eab308; }
        .bg-range { background-color: #ecfccb; }

        /* --- æŒ‡é’ˆ --- */
        .pointer {
            position: absolute; font-size: 12px; font-weight: bold; padding: 2px 6px; border-radius: 4px;
            transition: left 0.2s; white-space: nowrap; pointer-events: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 20;
        }

        /* é€šç”¨/ManacheræŒ‡é’ˆ */
        .ptr-c { color: #d97706; border: 1px solid #d97706; background: #fef3c7; top: -38px; }
        .ptr-r { color: #059669; border: 1px solid #059669; background: #d1fae5; top: -38px; }
        .ptr-i { color: #ef4444; font-size: 14px; top: -65px; font-weight: 800; border:none; background:transparent; box-shadow:none;}
        .ptr-i::after { content: 'â†“'; display: block; text-align: center; font-size: 18px; }

        /* ä¸­å¿ƒæ‰©å±•æ³•ç‰¹æœ‰æŒ‡é’ˆ */
        .ptr-center-line {
            position: absolute; top: -15px; width: 2px; height: 60px; background: #ef4444; opacity: 0.6; z-index: 0; transition: left 0.2s;
        }
        .ptr-center-line::after { content: 'Center'; position: absolute; top: -15px; left: -18px; font-size: 10px; color: #ef4444; font-weight: bold; }

        /* ç»“æœæŒ‡é’ˆ */
        .ptr-ans { color: #2563eb; border: 1px solid #2563eb; background: #eff6ff; bottom: -30px; }
        .ptr-ans::before { content: 'â–²'; position: absolute; top: -10px; left: 50%; transform: translateX(-50%); color: #2563eb; font-size: 8px; }

        /* --- ä¿¡æ¯é¢æ¿ä¸å›¾ä¾‹ --- */
        .info-panel { display: flex; gap: 15px; justify-content: center; margin-bottom: 10px; font-family: monospace; font-size: 14px; flex-wrap: wrap; min-height: 32px; }
        .var-box { padding: 4px 10px; background: #f1f5f9; border-radius: 4px; border: 1px solid #e2e8f0; display:flex; align-items:center;}
        .legend { display: flex; gap: 15px; font-size: 12px; color: #64748b; justify-content: center; margin-top: 5px; flex-wrap: wrap; min-height: 20px;}
        .dot { width: 10px; height: 10px; display: inline-block; margin-right: 4px; border-radius: 2px; vertical-align: middle;}

        .log-box {
            width: 100%; height: 80px; overflow-y: auto;
            background: #1e293b; color: #4ade80;
            font-family: 'Consolas', monospace; font-size: 13px;
            text-align: left; padding: 12px; border-radius: 8px; margin-top: 10px;
            white-space: pre-wrap; box-sizing: border-box;
        }

        /* --- å¯¹æ¯”è¡¨æ ¼ --- */
        .comparison-section { margin-top: 40px; width: 100%; max-width: 1100px;}
        .comp-table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.05); border-radius: 8px; overflow: hidden; font-size: 15px;}
        .comp-table th, .comp-table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #e2e8f0; }
        .comp-table th { background: #f8fafc; color: #475569; font-weight: 600; }
        .comp-table tr:last-child td { border-bottom: none; }
        .comp-table tr:hover { background-color: #f8fafc; }
        .tag { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .tag-bad { background: #fee2e2; color: #991b1b; }
        .tag-good { background: #dcfce7; color: #166534; }
        .tag-neu { background: #f1f5f9; color: #475569; }
    </style>
</head>
<body>

<div id="global-back-btn" style="position:fixed;top:15px;left:15px;z-index:9999;cursor:pointer;background:white;padding:8px 12px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);display:flex;align-items:center;gap:6px;border:1px solid #e2e8f0;transition:all 0.2s;user-select:none;">
    <span style="font-size:16px;">ğŸ”™</span><span style="font-weight:600;font-size:14px;color:#334155;">è¿”å›</span>
</div>
<script>
    document.getElementById('global-back-btn').addEventListener('click', () => {
        if(window.opener) window.close(); else window.history.back();
    });
</script>

<div class="container">
    <h1>å›æ–‡å­ä¸²ç®—æ³•å¯¹æ¯”</h1>

    <div class="algo-switch">
        <button class="algo-btn active" id="btn-algo-center" onclick="switchAlgo('center')">ä¸­å¿ƒæ‰©å±•æ³• (Naive)</button>
        <button class="algo-btn" id="btn-algo-manacher" onclick="switchAlgo('manacher')">Manacher ç®—æ³• (Optimized)</button>
    </div>

    <div class="controls-top">
        <input type="text" id="strInput" class="arr-input" value="babad" maxlength="15" placeholder="è¾“å…¥å­—ç¬¦ä¸²">
        <button class="btn-primary" onclick="initAndRun()">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
    </div>

    <div class="info-panel" id="infoPanel"></div>
    <div class="legend" id="legendPanel"></div>

    <div class="vis-wrapper" id="visArea"></div>

    <div class="controls-playback">
        <button class="btn-control" onclick="step(-1)">â®</button>
        <button class="btn-control" id="btnPlay" onclick="togglePlay()">â¯</button>
        <button class="btn-control" onclick="step(1)">â­</button>
        <input type="range" id="progressBar" value="0" min="0" max="0" oninput="scrub(this.value)">
        <span id="stepCounter" style="min-width:60px; font-family:monospace; font-weight:bold;">0/0</span>
    </div>

    <div class="log-box" id="logBox">å‡†å¤‡å°±ç»ª...</div>
</div>

<div class="comparison-section">
    <h3 style="margin-bottom: 15px; color:#334155;">ğŸ” ç®—æ³•æ ¸å¿ƒå¯¹æ¯”</h3>
    <table class="comp-table">
        <thead>
        <tr>
            <th width="15%">ç®—æ³•åç§°</th>
            <th width="15%">æ—¶é—´å¤æ‚åº¦</th>
            <th width="15%">ç©ºé—´å¤æ‚åº¦</th>
            <th width="25%">æ ¸å¿ƒæ€æƒ³</th>
            <th width="30%">ä¼˜ç¼ºç‚¹åˆ†æ</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><strong>ä¸­å¿ƒæ‰©å±•æ³•</strong><br><span style="font-size:12px;color:#64748b;">Center Expansion</span></td>
            <td><span class="tag tag-bad">O(NÂ²)</span></td>
            <td><span class="tag tag-good">O(1)</span></td>
            <td>æšä¸¾æ‰€æœ‰å¯èƒ½çš„ä¸­å¿ƒç‚¹ (2N-1ä¸ª)ï¼Œå‘ä¸¤è¾¹æ‰©å±•ç›´åˆ°ä¸åŒ¹é…ã€‚</td>
            <td>
                <span style="color:#166534">âœ” ç©ºé—´æœ€çœï¼Œé€»è¾‘ç®€å•æ˜“æ‡‚ã€‚</span><br>
                <span style="color:#991b1b">âœ˜ å­˜åœ¨å¤§é‡é‡å¤è®¡ç®—ï¼ˆä¾‹å¦‚ "aaaaa"ï¼‰ï¼Œæœ€åæƒ…å†µæ•ˆç‡ä½ã€‚</span>
            </td>
        </tr>
        <tr>
            <td><strong>Manacher</strong><br><span style="font-size:12px;color:#64748b;">é©¬æ‹‰è½¦ç®—æ³•</span></td>
            <td><span class="tag tag-good">O(N)</span></td>
            <td><span class="tag tag-neu">O(N)</span></td>
            <td>åˆ©ç”¨å›æ–‡çš„<b>é•œåƒå¯¹ç§°æ€§</b>ã€‚å·²çŸ¥å³è¾¹ç•Œ R å†…çš„æŸä¸ªç‚¹ï¼Œå¯ä»¥ç›´æ¥å‚è€ƒå…¶å…³äºä¸­å¿ƒ C çš„å¯¹ç§°ç‚¹æ•°å€¼ã€‚</td>
            <td>
                <span style="color:#166534">âœ” ä¸¥æ ¼çº¿æ€§æ—¶é—´ï¼Œå¤„ç†è¶…é•¿å­—ç¬¦ä¸²æå…¶å¿«é€Ÿã€‚</span><br>
                <span style="color:#991b1b">âœ˜ ä»£ç é€»è¾‘å¤æ‚ï¼Œéœ€è¦é¢„å¤„ç†å­—ç¬¦ä¸² (æ·»åŠ  #)ã€‚</span>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    // --- å…¨å±€çŠ¶æ€ ---
    let currentAlgo = 'center'; // 'center' or 'manacher'
    let frames = [];
    let currFrameIdx = 0;
    let timer = null;
    let isPlaying = false;
    let dataArr = []; // å­˜å‚¨æ˜¾ç¤ºçš„å­—ç¬¦æ•°ç»„ (åŸä¸² æˆ– å¸¦#ä¸²)

    // --- 1. ä¸­å¿ƒæ‰©å±•æ³•é€»è¾‘ ---
    function generateCenterFrames(str) {
        const history = [];
        const n = str.length;
        const chars = str.split('');
        dataArr = chars; // æ¸²æŸ“ç”¨

        let ansLeft = 0, ansRight = 0; // java substring(start, end) format [start, end)

        const record = (msg, type, i, l, r) => {
            history.push({
                algo: 'center', type, msg,
                i, l, r, ansLeft, ansRight,
                maxlen: ansRight - ansLeft
            });
        };

        record("ç®—æ³•å¼€å§‹", "init", -1, -1, -1);

        for(let i = 0; i < 2 * n - 1; i++){
            let l = Math.floor(i / 2);
            let r = Math.floor((i + 1) / 2);

            record(`Step i=${i}: ä¸­å¿ƒæ‰©å±•å¼€å§‹`, "start_loop", i, l, r);

            let matched = false;
            while(l >= 0 && r < n && chars[l] === chars[r]){
                matched = true;
                record(`S[${l}] == S[${r}] (${chars[l]}), åŒ¹é…æˆåŠŸ`, "match", i, l, r);
                l--; r++;
            }

            if(!matched) record(`S[${l}] != S[${r}], æ— æ³•æ‰©å±•`, "mismatch", i, l, r);
            else record(`æ‰©å±•ç»“æŸï¼Œè¾¹ç•Œ (${l+1}, ${r-1})`, "stop", i, l, r);

            // æ›´æ–°æœ€å¤§å€¼ (æ³¨æ„æ­¤æ—¶ lå’Œr å·²ç»å¤šèµ°äº†ä¸€æ ¼)
            // çœŸå®é•¿åº¦ = (r-1) - (l+1) + 1 = r - l - 1
            if(r - l - 1 > ansRight - ansLeft){
                ansLeft = l + 1;
                ansRight = r;
                record(`æ›´æ–°æœ€ä¼˜è§£: [${ansLeft}, ${ansRight})`, "update_ans", i, l, r);
            }
        }
        record(`ç»“æŸã€‚æœ€é•¿å›æ–‡: "${str.substring(ansLeft, ansRight)}"`, "done", -1, -1, -1);
        return history;
    }

    // --- 2. Manacher é€»è¾‘ ---
    function generateManacherFrames(str) {
        const history = [];
        // é¢„å¤„ç†
        const n = str.length * 2 + 1;
        const ss = new Array(n);
        let j = 0;
        for (let i = 0; i < n; i++) ss[i] = (i & 1) === 0 ? '#' : str[j++];
        dataArr = ss; // æ¸²æŸ“ç”¨

        const p = new Array(n).fill(0);
        let maxLen = 0, startPos = 0; // è®°å½•åŸä¸²ä¿¡æ¯ç”¨äºæœ€ç»ˆå±•ç¤º
        let c = 0, r = 0; // Manacher å˜é‡
        let endIdxInSS = 0; // ç”¨äºåœ¨ssæ•°ç»„ç”»ç»“æœæŒ‡é’ˆ

        const record = (msg, type, i, len, compL=-1, compR=-1) => {
            history.push({
                algo: 'manacher', type, msg,
                i, c, r, len,
                p: [...p],
                endIdxInSS,
                compL, compR
            });
        };

        record("é¢„å¤„ç†å­—ç¬¦ä¸²å®Œæˆ", "init", 0, 0);

        for (let i = 0; i < n; i++) {
            let len = 1;
            if (r > i) {
                let mirror = 2 * c - i;
                len = Math.min(p[mirror], r - i);
                record(`åˆ©ç”¨å¯¹ç§°æ€§: i=${i}, mirror=${mirror}, min(p[mirror], r-i)=${len}`, "calc", i, len);
            } else {
                record(`i=${i} >= R, æ— æ³•åˆ©ç”¨å¯¹ç§°æ€§, len=1`, "calc", i, len);
            }

            while (i + len < n && i - len >= 0) {
                const left = i - len, right = i + len;
                record(`æ¯”è¾ƒ ss[${left}] vs ss[${right}]`, "compare", i, len, left, right);
                if (ss[right] === ss[left]) len++;
                else {
                    record(`ä¸åŒ¹é…`, "mismatch", i, len, left, right);
                    break;
                }
            }

            if (i + len > r) {
                r = i + len; c = i;
                record(`æ›´æ–° Center=${c}, R=${r}`, "update_cr", i, len);
            }

            if (len - 1 > maxLen) {
                maxLen = len - 1;
                // è®¡ç®—åœ¨ SS ä¸­çš„ç»“æŸä½ç½®ç”¨äºå¯è§†åŒ–
                endIdxInSS = i + len - 1;
                record(`æ›´æ–°æœ€å¤§é•¿åº¦=${maxLen}`, "update_max", i, len);
            }
            p[i] = len;
            record(`Step i=${i} å®Œæˆ`, "finish_step", i, len);
        }
        record(`ç®—æ³•ç»“æŸ`, "done", n, 0);
        return history;
    }

    // --- 3. æ¸²æŸ“é€»è¾‘ (UI æ ¸å¿ƒ) ---
    function renderFrame(idx) {
        if (idx < 0 || idx >= frames.length) return;
        const frame = frames[idx];

        // A. æ›´æ–°é¢æ¿æ•°å€¼
        if(currentAlgo === 'center') {
            document.getElementById('val-i').innerText = frame.i === -1 ? '-' : frame.i;
            document.getElementById('val-l').innerText = frame.l === -1 ? '-' : frame.l;
            document.getElementById('val-r').innerText = frame.r === -1 ? '-' : frame.r;
            document.getElementById('val-maxlen').innerText = frame.maxlen !== undefined ? frame.maxlen : '-';
        } else {
            document.getElementById('val-i').innerText = frame.i >= dataArr.length ? '-' : frame.i;
            document.getElementById('val-c').innerText = frame.c;
            document.getElementById('val-r').innerText = frame.r;
            document.getElementById('val-len').innerText = frame.len;
        }

        document.getElementById('logBox').innerText = frame.msg;
        document.getElementById('progressBar').value = idx;
        document.getElementById('stepCounter').innerText = `${idx + 1}/${frames.length}`;

        // B. æ¸²æŸ“ DOM æ•°ç»„
        const container = document.getElementById('visArea');
        container.innerHTML = '';

        const row = document.createElement('div');
        row.className = 'array-row';
        const cellWidth = 48; // width + margins

        // æŒ‡é’ˆæ¸²æŸ“è¾…åŠ©
        const addPtr = (cls, text, idx, offset=0, extraStyle='') => {
            const d = document.createElement('div');
            d.className = `pointer ${cls}`;
            d.innerText = text;
            d.style.left = (idx * cellWidth + 10 + offset) + 'px';
            if(extraStyle) d.style.cssText += extraStyle;
            row.appendChild(d);
        };

        // --- æ¸²æŸ“ç‰¹å®šç®—æ³•çš„æŒ‡é’ˆ ---
        if(currentAlgo === 'center') {
            // Ans Range Markers
            if(frame.ansRight > frame.ansLeft) {
                addPtr('ptr-ans', 'AnsL', frame.ansLeft, -5);
                addPtr('ptr-ans', 'AnsR', frame.ansRight, -20); // Point to gap
            }
            // L & R
            if(frame.l !== -1) addPtr('ptr-l', 'L', frame.l);
            if(frame.r !== -1 && frame.r < dataArr.length) addPtr('ptr-r-exp', 'R', frame.r);
            // Center Line
            if (frame.i !== -1) {
                const ptrC = document.createElement('div');
                ptrC.className = 'ptr-center-line';
                ptrC.style.left = ((frame.i / 2) * cellWidth + 21) + 'px'; // ç²¾ç¡®è®¡ç®—åƒç´ ä½ç½®
                row.appendChild(ptrC);
            }
        } else {
            // Manacher Pointers
            addPtr('ptr-c', 'C', frame.c);
            addPtr('ptr-r', 'R', frame.r);
            if(frame.endIdxInSS > 0) addPtr('ptr-ans', 'MaxEnd', frame.endIdxInSS, -5);
        }

        // --- æ¸²æŸ“å•å…ƒæ ¼ ---
        dataArr.forEach((char, index) => {
            const wrap = document.createElement('div');
            wrap.className = 'cell-wrapper';

            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.innerText = char;

            // æ ·å¼é€»è¾‘
            if(currentAlgo === 'center') {
                // Ans Range
                if (index >= frame.ansLeft && index < frame.ansRight) cell.classList.add('bg-final');
                // Matching
                if (frame.type === 'match' && (index === frame.l || index === frame.r)) cell.classList.add('bg-match');
                if (frame.type === 'mismatch' && (index === frame.l || index === frame.r)) cell.classList.add('bg-mismatch');

            } else {
                // Manacher Styles
                if (index === frame.i) {
                    cell.classList.add('bg-i');
                    const ptrI = document.createElement('div');
                    ptrI.className = 'pointer ptr-i';
                    ptrI.style.position='absolute'; ptrI.style.left='5px';
                    wrap.appendChild(ptrI);
                }
                // Mirror
                if (frame.type === 'calc' && frame.r > frame.i) {
                    if (index === 2 * frame.c - frame.i) cell.classList.add('bg-mirror');
                }
                // Compare
                if ((frame.type === 'compare' || frame.type === 'mismatch') && (index === frame.compL || index === frame.compR)) {
                    cell.classList.add(frame.type === 'mismatch' ? 'bg-mismatch' : 'bg-match');
                }
                // Range
                if(index > frame.i - frame.len && index < frame.i + frame.len && index !== frame.i) {
                    cell.style.backgroundColor = '#ecfccb';
                }
            }

            // Manacher P values
            const pVal = document.createElement('div');
            pVal.className = 'p-val';
            if(currentAlgo === 'manacher' && frame.p[index] > 0) {
                pVal.innerText = frame.p[index];
                pVal.classList.add('show');
            }

            const idxLabel = document.createElement('div');
            idxLabel.className = 'idx-label';
            idxLabel.innerText = index;

            wrap.appendChild(cell);
            wrap.appendChild(pVal);
            wrap.appendChild(idxLabel);
            row.appendChild(wrap);
        });

        container.appendChild(row);

        // Auto Scroll
        const focusIdx = (currentAlgo === 'center') ? (frame.i/2) : frame.i;
        if (focusIdx * cellWidth > container.clientWidth / 2) {
            container.scrollLeft = (focusIdx * cellWidth) - (container.clientWidth / 2);
        } else {
            container.scrollLeft = 0;
        }
    }

    // --- åˆ‡æ¢ä¸æ§åˆ¶ ---
    function switchAlgo(algoName) {
        currentAlgo = algoName;
        // UI Tabs
        document.querySelectorAll('.algo-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-algo-' + algoName).classList.add('active');

        // Update Info Panel HTML
        const panel = document.getElementById('infoPanel');
        const legend = document.getElementById('legendPanel');

        if(algoName === 'center') {
            panel.innerHTML = `
                <div class="var-box">i (Loop) = <span id="val-i">-</span></div>
                <div class="var-box" style="color:#d97706">L = <span id="val-l">-</span></div>
                <div class="var-box" style="color:#059669">R = <span id="val-r">-</span></div>
                <div class="var-box" style="border-color:#eab308;background:#fefce8">MaxLen = <span id="val-maxlen">0</span></div>
            `;
            legend.innerHTML = `
                <span><span class="dot" style="background:#ef4444;"></span>ä¸­å¿ƒè½´</span>
                <span><span class="dot" style="background:#86efac;"></span>å°è¯•åŒ¹é…</span>
                <span><span class="dot" style="background:#fde047;"></span>å½“å‰æœ€ä¼˜è§£</span>
            `;
        } else {
            panel.innerHTML = `
                <div class="var-box">i (Curr) = <span id="val-i">-</span></div>
                <div class="var-box" style="color:#d97706">C (Center) = <span id="val-c">-</span></div>
                <div class="var-box" style="color:#059669">R (Bound) = <span id="val-r">-</span></div>
                <div class="var-box">Len (Radius) = <span id="val-len">-</span></div>
            `;
            legend.innerHTML = `
                <span><span class="dot" style="border:2px solid #ef4444;"></span>å½“å‰ i</span>
                <span><span class="dot" style="background:#f3e8ff; border:1px dashed #9333ea"></span>é•œåƒç‚¹ Mirror</span>
                <span><span class="dot" style="background:#ecfccb;"></span>P[i]è¦†ç›–èŒƒå›´</span>
            `;
        }

        initAndRun();
    }

    function initAndRun() {
        stopPlay();
        const str = document.getElementById('strInput').value || 'babad';

        if(currentAlgo === 'center') frames = generateCenterFrames(str);
        else frames = generateManacherFrames(str);

        document.getElementById('progressBar').max = Math.max(0, frames.length - 1);
        scrub(0);
    }

    function step(delta) {
        let next = currFrameIdx + delta;
        if (next >= 0 && next < frames.length) {
            currFrameIdx = next;
            renderFrame(currFrameIdx);
        } else if (isPlaying) stopPlay();
    }

    function scrub(val) {
        stopPlay();
        currFrameIdx = parseInt(val);
        renderFrame(currFrameIdx);
    }

    function togglePlay() {
        if (isPlaying) stopPlay(); else startPlay();
    }

    function startPlay() {
        if (currFrameIdx >= frames.length - 1) currFrameIdx = 0;
        isPlaying = true;
        document.getElementById('btnPlay').innerText = 'â¸';
        let speed = currentAlgo === 'manacher' ? 400 : 250; // Manacher slightly slower to read
        timer = setInterval(() => step(1), speed);
    }

    function stopPlay() {
        isPlaying = false;
        document.getElementById('btnPlay').innerText = 'â¯';
        clearInterval(timer);
    }

    // Init
    window.onload = () => switchAlgo('center');
</script>
</body>
</html>
