<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èºæ—‹çŸ©é˜µç®—æ³•å¯è§†åŒ– (Spiral Matrix)</title>
    <style>
        :root {
            --cell-size: 60px;
            --gap: 10px;
            --primary: #3b82f6;
            --visited: #d1d5db;
            --current: #22c55e;
            --border-color: #ef4444;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #f8fafc;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            height: 100vh;
            margin: 0;
        }

        h1 { color: #1e293b; margin-bottom: 20px; }

        .main-container {
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }

        /* å·¦ä¾§ï¼šå¯è§†åŒ–åŒºåŸŸ */
        .viz-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .matrix-wrapper {
            position: relative;
            padding: 40px; /* ç»™è¾¹ç•ŒæŒ‡é’ˆç•™ç©ºé—´ */
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .grid {
            display: grid;
            gap: var(--gap);
            /* grid-template-columns ä¼šåœ¨JSä¸­è®¾ç½® */
        }

        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background: #f1f5f9;
            border: 2px solid #cbd5e1;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2rem;
            font-weight: bold;
            color: #475569;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .cell.visited {
            background-color: var(--visited);
            color: #9ca3af;
            border-color: #9ca3af;
        }

        .cell.active {
            background-color: var(--current);
            color: white;
            border-color: #15803d;
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }

        /* è¾¹ç•Œçº¿/æŒ‡é’ˆæ ·å¼ */
        .boundary-line {
            position: absolute;
            background-color: var(--border-color);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .boundary-label {
            background: var(--border-color);
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            white-space: nowrap;
            position: absolute;
        }

        /* ä¸Šè¾¹ç•Œ T */
        #line-t { height: 2px; width: 0; left: 40px; }
        #line-t .boundary-label { bottom: 5px; left: 50%; transform: translateX(-50%); }

        /* ä¸‹è¾¹ç•Œ B */
        #line-b { height: 2px; width: 0; left: 40px; }
        #line-b .boundary-label { top: 5px; left: 50%; transform: translateX(-50%); }

        /* å·¦è¾¹ç•Œ L */
        #line-l { width: 2px; height: 0; top: 40px; }
        #line-l .boundary-label { right: 5px; top: 50%; transform: translateY(-50%); }

        /* å³è¾¹ç•Œ R */
        #line-r { width: 2px; height: 0; top: 40px; }
        #line-r .boundary-label { left: 5px; top: 50%; transform: translateY(-50%); }


        /* å³ä¾§ï¼šä»£ç ä¸æ§åˆ¶ */
        .control-panel {
            width: 400px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .info-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .status-text {
            font-size: 16px;
            color: #334155;
            margin-bottom: 5px;
            min-height: 48px;
        }

        .result-array {
            font-family: monospace;
            color: #0f172a;
            word-break: break-all;
            background: #f1f5f9;
            padding: 8px;
            border-radius: 4px;
            margin-top: 5px;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.2s;
        }

        .btn-prev { background: #e2e8f0; color: #475569; }
        .btn-next { background: var(--primary); color: white; }
        .btn-reset { background: #fca5a5; color: #7f1d1d; }
        .btn-next:hover { background: #2563eb; }

        /* ä»£ç é«˜äº®åŒºåŸŸ */
        .code-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', monospace;
            font-size: 13px;
            overflow-x: auto;
            line-height: 1.5;
        }

        .code-line {
            padding: 0 4px;
            border-left: 3px solid transparent;
        }
        .code-line.active-line {
            background-color: #374151;
            border-left-color: var(--current);
            color: white;
        }

        .var-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            font-size: 12px;
            margin-right: 5px;
        }
        .bg-t { background: #ef4444; } /* Red */
        .bg-b { background: #ef4444; }
        .bg-l { background: #ef4444; }
        .bg-r { background: #ef4444; }

    </style>
</head>
<body>
<div id="global-back-btn" style="position: fixed; top: 15px; left: 15px; z-index: 9999; cursor: pointer; background: white; padding: 8px 12px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 6px; font-family: 'Segoe UI', sans-serif; border: 1px solid #e2e8f0; transition: all 0.2s; user-select: none;">
    <span style="font-size: 16px;">ğŸ”™</span>
    <span style="font-weight: 600; font-size: 14px; color: #334155;">è¿”å›ç›®å½•</span>
</div>
<h1>èºæ—‹çŸ©é˜µç®—æ³•å¯è§†åŒ– (Spiral Array)</h1>

<div class="main-container">
    <div class="viz-section">
        <div class="matrix-wrapper">
            <div id="grid" class="grid"></div>

            <div id="line-t" class="boundary-line"><span class="boundary-label">t (Top)</span></div>
            <div id="line-b" class="boundary-line"><span class="boundary-label">b (Bottom)</span></div>
            <div id="line-l" class="boundary-line"><span class="boundary-label">l (Left)</span></div>
            <div id="line-r" class="boundary-line"><span class="boundary-label">r (Right)</span></div>
        </div>
    </div>

    <div class="control-panel">
        <div class="info-box">
            <div id="status" class="status-text">å‡†å¤‡å°±ç»ª...</div>
            <div>
                <strong>å½“å‰è¾¹ç•Œ:</strong>
                l: <span id="val-l">0</span>, r: <span id="val-r">0</span>,
                t: <span id="val-t">0</span>, b: <span id="val-b">0</span>
            </div>
            <div style="margin-top:10px;"><strong>ç»“æœ (res):</strong></div>
            <div id="res-array" class="result-array">[]</div>
        </div>

        <div class="controls">
            <button class="btn-prev" onclick="prevStep()">ä¸Šä¸€æ­¥</button>
            <button class="btn-next" onclick="nextStep()">ä¸‹ä¸€æ­¥</button>
            <button class="btn-reset" onclick="reset()">é‡ç½®</button>
        </div>

        <div class="code-container" id="code-box">
        </div>
    </div>
</div>

<script>
    // ================= é…ç½®ä¸æ•°æ® =================
    const MATRIX = [
        [1, 2, 3, 4],
        [5, 6, 7, 8],
        [9, 10, 11, 12],
        [13, 14, 15, 16]
    ];
    // ä½ å¯ä»¥ä¿®æ”¹ä¸Šé¢çš„çŸ©é˜µå¤§å°æ¥æµ‹è¯•ä¸åŒæƒ…å†µï¼Œæ¯”å¦‚ 3x3 æˆ– 3x4

    const ROWS = MATRIX.length;
    const COLS = MATRIX[0].length;

    // å¯¹åº” Java ä»£ç è¡Œ (ç”¨äºé«˜äº®)
    const JAVA_CODE = [
        "public int[] spiralArray(int[][] matrix) {",
        "    if(matrix.length==0) return new int[0];",
        "    int l = 0, r = matrix[0].length-1, t = 0, b = matrix.length-1;",
        "    int[] res = new int[(r+1)*(b+1)]; int x = 0;",
        "    while(true){",
        "        for(int i = l; i <= r; i++) res[x++] = matrix[t][i];", // 5: Top -> Right
        "        if(++t > b) break;",                                     // 6: t move
        "        for(int j = t; j <= b; j++) res[x++] = matrix[j][r];", // 7: Right -> Bottom
        "        if(l > --r) break;",                                     // 8: r move
        "        for(int i = r; i >= l; i--) res[x++] = matrix[b][i];", // 9: Bottom -> Left
        "        if(--b < t) break;",                                     // 10: b move
        "        for(int j = b; j >= t; j--) res[x++] = matrix[j][l];", // 11: Left -> Top
        "        if(++l > r) break;",                                     // 12: l move
        "    }",
        "    return res;",
        "}"
    ];

    // ================= çŠ¶æ€ç®¡ç† =================
    let steps = [];
    let currentStepIndex = -1;

    // ================= åˆå§‹åŒ– DOM =================
    function init() {
        // 1. ç”Ÿæˆç½‘æ ¼
        const grid = document.getElementById('grid');
        grid.style.gridTemplateColumns = `repeat(${COLS}, var(--cell-size))`;

        grid.innerHTML = '';
        for(let i=0; i<ROWS; i++) {
            for(let j=0; j<COLS; j++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `cell-${i}-${j}`;
                cell.textContent = MATRIX[i][j];
                grid.appendChild(cell);
            }
        }

        // 2. ç”Ÿæˆä»£ç æ˜¾ç¤º
        const codeBox = document.getElementById('code-box');
        codeBox.innerHTML = JAVA_CODE.map((line, idx) =>
            `<div class="code-line" id="line-${idx}">${line.replace(/</g, '&lt;')}</div>`
        ).join('');

        // 3. è®¡ç®—æ‰€æœ‰æ­¥éª¤
        generateSteps();

        // 4. æ¸²æŸ“åˆå§‹çŠ¶æ€
        updateVisuals();
    }

    // ================= æ ¸å¿ƒé€»è¾‘ï¼šç”Ÿæˆæ­¥éª¤å¿«ç…§ =================
    function generateSteps() {
        steps = [];
        // åˆå§‹çŠ¶æ€
        let l = 0, r = COLS - 1, t = 0, b = ROWS - 1;
        let res = [];

        // è®°å½•åˆå§‹å¿«ç…§
        recordStep(l, r, t, b, [], null, -1, "ç®—æ³•å¼€å§‹ï¼Œåˆå§‹åŒ–è¾¹ç•ŒæŒ‡é’ˆ");
        recordStep(l, r, t, b, [], null, 2, `l=${l}, r=${r}, t=${t}, b=${b}`);

        while(true) {
            // 1. Left to Right
            for(let i = l; i <= r; i++) {
                res.push(MATRIX[t][i]);
                recordStep(l, r, t, b, [...res], [t, i], 5, `å‘å³éå†: matrix[${t}][${i}] åŠ å…¥ç»“æœ`);
            }
            // t++
            t++;
            recordStep(l, r, t, b, [...res], null, 6, `ä¸Šè¾¹ç•Œ t ä¸‹ç§»ï¼Œç°åœ¨ t=${t}`);
            if(t > b) break;

            // 2. Top to Bottom
            for(let j = t; j <= b; j++) {
                res.push(MATRIX[j][r]);
                recordStep(l, r, t, b, [...res], [j, r], 7, `å‘ä¸‹éå†: matrix[${j}][${r}] åŠ å…¥ç»“æœ`);
            }
            // r--
            r--;
            recordStep(l, r, t, b, [...res], null, 8, `å³è¾¹ç•Œ r å·¦ç§»ï¼Œç°åœ¨ r=${r}`);
            if(l > r) break;

            // 3. Right to Left
            for(let i = r; i >= l; i--) {
                res.push(MATRIX[b][i]);
                recordStep(l, r, t, b, [...res], [b, i], 9, `å‘å·¦éå†: matrix[${b}][${i}] åŠ å…¥ç»“æœ`);
            }
            // b--
            b--;
            recordStep(l, r, t, b, [...res], null, 10, `ä¸‹è¾¹ç•Œ b ä¸Šç§»ï¼Œç°åœ¨ b=${b}`);
            if(b < t) break;

            // 4. Bottom to Top
            for(let j = b; j >= t; j--) {
                res.push(MATRIX[j][l]);
                recordStep(l, r, t, b, [...res], [j, l], 11, `å‘ä¸Šéå†: matrix[${j}][${l}] åŠ å…¥ç»“æœ`);
            }
            // l++
            l++;
            recordStep(l, r, t, b, [...res], null, 12, `å·¦è¾¹ç•Œ l å³ç§»ï¼Œç°åœ¨ l=${l}`);
            if(l > r) break;
        }

        recordStep(l, r, t, b, [...res], null, 14, "éå†ç»“æŸï¼Œè¿”å›ç»“æœ");
    }

    function recordStep(l, r, t, b, res, activeCell, lineNum, msg) {
        steps.push({
            l, r, t, b,
            res,
            activeCell, // [row, col] or null
            lineNum,
            msg
        });
    }

    // ================= æ¸²æŸ“é€»è¾‘ =================
    function updateVisuals() {
        if(currentStepIndex < 0) {
            resetVisuals();
            return;
        }

        const s = steps[currentStepIndex];

        // 1. æ›´æ–°æ–‡æœ¬ä¿¡æ¯
        document.getElementById('status').textContent = s.msg;
        document.getElementById('val-l').textContent = s.l;
        document.getElementById('val-r').textContent = s.r;
        document.getElementById('val-t').textContent = s.t;
        document.getElementById('val-b').textContent = s.b;
        document.getElementById('res-array').textContent = '[' + s.res.join(', ') + ']';

        // 2. ä»£ç é«˜äº®
        document.querySelectorAll('.code-line').forEach(el => el.classList.remove('active-line'));
        if(s.lineNum >= 0) {
            const line = document.getElementById(`line-${s.lineNum}`);
            if(line) {
                line.classList.add('active-line');
                // è‡ªåŠ¨æ»šåŠ¨åˆ°ä¸­é—´
                line.scrollIntoView({block: 'center', behavior: 'smooth'});
            }
        }

        // 3. å•å…ƒæ ¼æ ·å¼
        // é‡ç½®æ‰€æœ‰ Activeï¼Œä¿ç•™ Visited
        document.querySelectorAll('.cell').forEach(c => c.classList.remove('active'));

        // æ ‡è®°å·²è®¿é—® (æ ¹æ®å½“å‰ç»“æœé›†çš„å†…å®¹ï¼Œåæ¨å·²è®¿é—®çš„æ ¼å­ï¼Œç®€å•ç²—æš´ä½†æœ‰æ•ˆ)
        // æ›´ç²¾ç¡®çš„åšæ³•ï¼šæ ¹æ® activeCell ç´¯åŠ ã€‚ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬é‡æ–°éå†ä¸€ä¸‹ steps[0] åˆ° steps[current] çš„ activeCell
        for(let i=0; i<=currentStepIndex; i++) {
            const step = steps[i];
            if(step.activeCell) {
                const cell = document.getElementById(`cell-${step.activeCell[0]}-${step.activeCell[1]}`);
                if(cell) cell.classList.add('visited');
            }
        }

        // é«˜äº®å½“å‰æ ¼
        if(s.activeCell) {
            const cell = document.getElementById(`cell-${s.activeCell[0]}-${s.activeCell[1]}`);
            if(cell) {
                cell.classList.remove('visited'); // å½“å‰æ ¼ä¸é«˜äº® visited é¢œè‰²
                cell.classList.add('active');
            }
        }

        // 4. æ›´æ–°çº¢çº¿ä½ç½® (Visual Walls)
        updateBoundaries(s.l, s.r, s.t, s.b);
    }

    function updateBoundaries(l, r, t, b) {
        // è®¡ç®—åƒç´ ä½ç½®
        // 40px padding + (index * (60 + 10))
        const cellSize = 60;
        const gap = 10;
        const padding = 40;
        const totalWidth = COLS * (cellSize + gap) - gap;
        const totalHeight = ROWS * (cellSize + gap) - gap;

        const getPos = (idx) => padding + idx * (cellSize + gap);

        const lineT = document.getElementById('line-t');
        const lineB = document.getElementById('line-b');
        const lineL = document.getElementById('line-l');
        const lineR = document.getElementById('line-r');

        // Top Line (æ°´å¹³çº¿ï¼Œä½äº t è¡Œä¸Šæ–¹)
        // ä¸ºäº†è§†è§‰æ•ˆæœï¼Œæˆ‘ä»¬æŠŠå®ƒæ”¾åœ¨ t è¡Œçš„â€œä¸Šè¾¹ç¼˜â€ç¨å¾®ä¸Šé¢ä¸€ç‚¹ï¼Œæˆ–è€…æ­£åˆ‡ç€ t è¡Œ
        // è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼št ä»£è¡¨"åŒ…å«t"ï¼Œæ‰€ä»¥çº¿åº”è¯¥åœ¨ t-1 å’Œ t ä¹‹é—´ã€‚
        // ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬è®©çº¿ç›´æ¥å®šä½åœ¨ t è¡Œçš„é¡¶éƒ¨ Y è½´ä½ç½®
        let topY = getPos(t) - 5;
        lineT.style.top = `${topY}px`;
        lineT.style.width = `${totalWidth}px`;

        // Bottom Line (æ°´å¹³çº¿ï¼Œä½äº b è¡Œä¸‹æ–¹)
        // ä½äº b è¡Œåº•éƒ¨
        let bottomY = getPos(b) + cellSize + 5;
        lineB.style.top = `${bottomY}px`;
        lineB.style.width = `${totalWidth}px`;

        // Left Line (å‚ç›´çº¿ï¼Œä½äº l åˆ—å·¦ä¾§)
        let leftX = getPos(l) - 5;
        lineL.style.left = `${leftX}px`;
        lineL.style.height = `${totalHeight}px`;

        // Right Line (å‚ç›´çº¿ï¼Œä½äº r åˆ—å³ä¾§)
        let rightX = getPos(r) + cellSize + 5;
        lineR.style.left = `${rightX}px`;
        lineR.style.height = `${totalHeight}px`;

        // ç‰¹æ®Šå¤„ç†ï¼šå¦‚æœ t > b æˆ– l > rï¼Œè®©çº¿äº¤å‰è¡¨ç¤ºç»“æŸ
        if(t > b) {
            lineT.style.opacity = '0.3';
            lineB.style.opacity = '0.3';
        } else {
            lineT.style.opacity = '1';
            lineB.style.opacity = '1';
        }
        if(l > r) {
            lineL.style.opacity = '0.3';
            lineR.style.opacity = '0.3';
        } else {
            lineL.style.opacity = '1';
            lineR.style.opacity = '1';
        }
    }

    function resetVisuals() {
        document.querySelectorAll('.cell').forEach(c => {
            c.classList.remove('active', 'visited');
        });
        document.getElementById('status').textContent = "å‡†å¤‡å¼€å§‹";
        document.getElementById('res-array').textContent = "[]";
        document.getElementById('val-l').textContent = 0;
        document.getElementById('val-r').textContent = COLS-1;
        document.getElementById('val-t').textContent = 0;
        document.getElementById('val-b').textContent = ROWS-1;
        document.querySelectorAll('.code-line').forEach(el => el.classList.remove('active-line'));
        updateBoundaries(0, COLS-1, 0, ROWS-1);
    }

    // ================= æŒ‰é’®æ§åˆ¶ =================
    function nextStep() {
        if(currentStepIndex < steps.length - 1) {
            currentStepIndex++;
            updateVisuals();
        }
    }

    function prevStep() {
        if(currentStepIndex > 0) {
            // éœ€è¦å®Œå…¨é‡ç»˜æ¥æ¸…é™¤ visited çŠ¶æ€
            // ç®€å•æ–¹æ³•ï¼šé‡ç½®æ‰€æœ‰ visitedï¼Œç„¶åé‡æ–°æ ¹æ®å†å² activeCell æ·»åŠ 
            const targetIdx = currentStepIndex - 1;
            document.querySelectorAll('.cell').forEach(c => c.classList.remove('visited', 'active'));
            currentStepIndex = targetIdx;
            updateVisuals();
        } else if (currentStepIndex === 0) {
            currentStepIndex = -1;
            resetVisuals();
        }
    }

    function reset() {
        currentStepIndex = -1;
        resetVisuals();
    }

    // å¯åŠ¨
    window.onload = init;
    document.getElementById('global-back-btn').addEventListener('click', () => {
        // é€»è¾‘ï¼šå¦‚æœæ˜¯è¢«çˆ¶çª—å£æ‰“å¼€çš„ï¼ˆBlob URLæ¨¡å¼ï¼‰ï¼Œåˆ™å…³é—­è‡ªå·±
        if (window.opener) {
            window.close();
        }
        // é€»è¾‘ï¼šå¦‚æœæ˜¯ç›´æ¥æ‰“å¼€æ–‡ä»¶çš„ï¼Œåˆ™å°è¯•å›é€€æˆ–è·³è½¬
        else {
            if (document.referrer) {
                window.history.back();
            } else {
                // å¦‚æœæ²¡æœ‰å†å²è®°å½•ï¼ˆç›´æ¥åŒå‡»æ‰“å¼€ï¼‰ï¼Œå°è¯•è·³è½¬åˆ°åŒçº§ç›®å½•ä¸‹çš„ index.html
                window.location.href = './index.html'; // å‡è®¾ index.html åœ¨åŒçº§
                // æˆ–è€…å°è¯•è·³åˆ°ä¸Šä¸€çº§
                // window.location.href = '../index.html';
            }
        }
    });

    // é¼ æ ‡æ‚¬åœæ•ˆæœ
    const btn = document.getElementById('global-back-btn');
    btn.onmouseover = () => { btn.style.transform = 'translateY(-2px)'; btn.style.boxShadow = '0 6px 16px rgba(0,0,0,0.2)'; };
    btn.onmouseout = () => { btn.style.transform = 'none'; btn.style.boxShadow = '0 4px 12px rgba(0,0,0,0.15)'; };
</script>
</body>
</html>
