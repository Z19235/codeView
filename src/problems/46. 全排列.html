<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨æ’åˆ— (Permutations) å¯è§†åŒ–</title>
    <style>
        body{font-family:'Segoe UI',sans-serif;padding:20px;text-align:center;background:#f8fafc;color:#333; display:flex; flex-direction:column; align-items:center;}
        .container{background:white;padding:30px;border-radius:12px;box-shadow:0 4px 6px rgba(0,0,0,0.1);display:inline-block; max-width: 1000px; width: 95%;}

        /* é¡¶éƒ¨æ§åˆ¶ */
        .controls-top { margin-bottom: 20px; display: flex; gap: 10px; justify-content: center; align-items: center; flex-wrap: wrap; }
        .mode-switch { background: #e2e8f0; padding: 5px; border-radius: 8px; display: flex; }
        .mode-btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; color: #64748b; background: transparent; transition: 0.2s; }
        .mode-btn.active { background: white; color: #3b82f6; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        input.arr-input { padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; width: 120px; text-align: center; font-size: 16px; }
        button.action-btn { background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        button.action-btn:hover { background: #2563eb; }

        /* å¯è§†åŒ–èˆå° */
        .vis-stage {
            min-height: 280px;
            background: #f8fafc;
            border: 1px dashed #cbd5e1;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        /* æ•°ç»„å®¹å™¨ */
        .array-row { display: flex; gap: 15px; margin-bottom: 20px; align-items: center; }
        .row-label { font-size: 14px; font-weight: bold; color: #64748b; min-width: 80px; text-align: right; margin-right: 10px;}

        /* èŠ‚ç‚¹æ ·å¼ */
        .node {
            width: 50px; height: 50px;
            border: 2px solid #cbd5e1;
            background: white;
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; font-weight: bold;
            border-radius: 8px;
            position: relative;
            transition: all 0.2s;
        }
        .node .idx-label { position: absolute; bottom: -20px; font-size: 12px; color: #94a3b8; font-weight: normal; }

        /* çŠ¶æ€é«˜äº® */
        .hl-fixed { background: #dbeafe; border-color: #3b82f6; } /* å·²å›ºå®šåŒºåŸŸ */
        .hl-pivot { border-color: #f59e0b; background: #fef3c7; z-index: 2; box-shadow: 0 0 0 2px #fcd34d;} /* æŒ‡é’ˆ i */
        .hl-swap-target { border-color: #ef4444; background: #fee2e2; } /* æŒ‡é’ˆ j */
        .hl-used { background: #f1f5f9; color: #cbd5e1; text-decoration: line-through; border-color: #e2e8f0; } /* Visited=true */
        .hl-path { background: #dcfce7; border-color: #22c55e; } /* In Path */

        /* æ’­æ”¾æ§åˆ¶ */
        .controls-playback { display: flex; gap: 10px; justify-content: center; align-items: center; background: #f1f5f9; padding: 10px; border-radius: 8px; }
        .btn-ctrl { background: white; border: 1px solid #cbd5e1; min-width: 40px; height: 36px; border-radius: 6px; cursor: pointer; }
        .btn-ctrl:hover { background: #e2e8f0; }
        #progressBar { width: 300px; cursor: pointer; accent-color: #3b82f6; }

        .log-box { margin-top: 15px; font-family: monospace; color: #3b82f6; font-weight: bold; height: 30px; }
        .result-box { margin-top: 10px; font-size: 14px; color: #64748b; min-height: 40px; word-break: break-all;}

        /* è¡¨æ ¼æ ·å¼ */
        .comp-table { width: 100%; border-collapse: collapse; margin-top: 30px; font-size: 14px; text-align: left; }
        .comp-table th, .comp-table td { border: 1px solid #e2e8f0; padding: 10px; }
        .comp-table th { background: #f1f5f9; color: #475569; }
        .tag { padding: 2px 6px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .tag-good { background: #dcfce7; color: #166534; }
        .tag-bad { background: #fee2e2; color: #991b1b; }
        .tag-neu { background: #f1f5f9; color: #475569; }

    </style>
</head>
<body>

<div id="global-back-btn" style="position:fixed;top:15px;left:15px;z-index:9999;cursor:pointer;background:white;padding:8px 12px;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);display:flex;align-items:center;gap:6px;border:1px solid #e2e8f0;transition:all 0.2s;user-select:none;">
    <span style="font-size:16px;">ğŸ”™</span><span style="font-weight:600;font-size:14px;color:#334155;">è¿”å›ç›®å½•</span>
</div>
<script>
    document.getElementById('global-back-btn').addEventListener('click', () => {
        if(window.opener) window.close();
        else window.history.back();
    });
</script>

<div class="container">
    <h1>å…¨æ’åˆ— (Permutations) ç®—æ³•å¯¹æ¯”</h1>

    <div class="controls-top">
        <div class="mode-switch">
            <button class="mode-btn active" onclick="switchMode('swap')" id="btn-swap">äº¤æ¢æ³• (Swap)</button>
            <button class="mode-btn" onclick="switchMode('visited')" id="btn-visited">æ ‡è®°æ³• (Visited)</button>
        </div>
        <span style="margin-left:10px; font-size:14px; color:#64748b;">è¾“å…¥æ•°ç»„:</span>
        <input type="text" id="arrInput" class="arr-input" value="1,2,3">
        <button class="action-btn" onclick="init()">ğŸ”„ ç”Ÿæˆ</button>
    </div>

    <div class="vis-stage" id="stage"></div>

    <div class="log-box" id="logMsg">å‡†å¤‡å°±ç»ª...</div>
    <div class="result-box" id="resList">å½“å‰ç»“æœ: []</div>

    <div class="controls-playback">
        <button class="btn-ctrl" onclick="step(-1)">â®</button>
        <button class="btn-ctrl" id="btnPlay" onclick="togglePlay()">â¯</button>
        <button class="btn-ctrl" onclick="step(1)">â­</button>
        <input type="range" id="progressBar" value="0" min="0" max="0" oninput="scrub(this.value)">
        <span id="stepCounter" style="font-family:monospace; width:60px;">0/0</span>
    </div>

    <h3>æ ¸å¿ƒå¤æ‚åº¦å¯¹æ¯”</h3>
    <table class="comp-table">
        <thead>
        <tr>
            <th width="15%">ç»´åº¦</th>
            <th width="42%">è§£æ³•ä¸€ï¼šäº¤æ¢æ³• (Swap)</th>
            <th width="43%">è§£æ³•äºŒï¼šæ ‡è®°æ³• (Visited Array)</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td><strong>æ—¶é—´å¤æ‚åº¦</strong></td>
            <td><span class="tag tag-neu">O(N Ã— N!)</span><br>å…¨æ’åˆ—å…±æœ‰ N! ç§ï¼Œç”Ÿæˆæ¯ä¸ªç»“æœéœ€è¦å¤åˆ¶æ•°ç»„ O(N)ã€‚</td>
            <td><span class="tag tag-neu">O(N Ã— N!)</span><br>åŒç†ï¼Œé€’å½’å±‚æ•° Nï¼Œæ¯å±‚å¾ªç¯ N æ¬¡ï¼Œæ€»å¶å­èŠ‚ç‚¹ N!ã€‚</td>
        </tr>
        <tr>
            <td><strong>ç©ºé—´å¤æ‚åº¦</strong></td>
            <td>
                <span class="tag tag-good">O(N)</span><br>
                ä¸»è¦æ¶ˆè€—é€’å½’æ ˆç©ºé—´ O(N)ã€‚<br>
                <small>*ä¸è€ƒè™‘å­˜å‚¨ç»“æœé›†çš„ç©ºé—´</small>
            </td>
            <td>
                <span class="tag tag-neu">O(N)</span><br>
                é€’å½’æ ˆ O(N) + æ ‡è®°æ•°ç»„ boolean[N] + è·¯å¾„åˆ—è¡¨ Path[N]ã€‚<br>
                <small>è™½åŒä¸º O(N)ï¼Œä½†å®é™…è¾…åŠ©ç©ºé—´æ›´å¤šã€‚</small>
            </td>
        </tr>
        <tr>
            <td><strong>æ ¸å¿ƒé€»è¾‘</strong></td>
            <td>
                <strong>åŸåœ°ä¿®æ”¹</strong>ï¼šé€šè¿‡ swap æ”¹å˜æ•°ç»„é¡ºåºã€‚<br>
                ç»´æŠ¤ [0...i-1] ä¸ºå·²ç¡®å®šéƒ¨åˆ†ï¼Œ[i...n] ä¸ºå¾…é€‰éƒ¨åˆ†ã€‚
            </td>
            <td>
                <strong>æ”¶é›†è·¯å¾„</strong>ï¼šç»´æŠ¤ä¸€ä¸ª path åˆ—è¡¨ã€‚<br>
                é€šè¿‡ boolean[] flag è®°å½•å“ªäº›æ•°å­—å·²è¢«ä½¿ç”¨ã€‚
            </td>
        </tr>
        <tr>
            <td><strong>å­—å…¸åº</strong></td>
            <td>
                <span class="tag tag-bad">ä¸ä¿è¯</span><br>
                äº¤æ¢å›æº¯åï¼Œå‰©ä½™å…ƒç´ çš„ç›¸å¯¹é¡ºåºå¯èƒ½è¢«æ‰“ä¹±ã€‚
            </td>
            <td>
                <span class="tag tag-good">ä¿è¯</span><br>
                å¦‚æœè¾“å…¥æœ‰åºï¼ŒæŒ‰é¡ºåºéå†å¹¶æ ‡è®°ï¼Œç»“æœè‡ªç„¶æœ‰åºã€‚
            </td>
        </tr>
        </tbody>
    </table>
</div>

<script>
    let mode = 'swap';
    let frames = [];
    let curIdx = 0;
    let timer = null;
    let isPlaying = false;
    let currentResults = []; // ç´¯ç§¯ç»“æœ

    // --- ç®—æ³• 1ï¼šäº¤æ¢æ³• (æ¨¡æ‹Ÿç”Ÿæˆå¸§) ---
    function generateSwapFrames(arr) {
        let history = [];
        let nums = [...arr];
        let collectedRes = [];

        const record = (type, msg, i, j, currNums) => {
            history.push({
                mode: 'swap', type, msg,
                nums: [...currNums],
                i, j,
                results: [...collectedRes]
            });
        };

        function dfs(idx) {
            if (idx === nums.length) {
                let temp = [...nums];
                collectedRes.push(temp);
                record('found', `æ‰¾åˆ°ä¸€ä¸ªæ’åˆ—: [${temp.join(',')}]`, idx, -1, nums);
                return;
            }

            for (let k = idx; k < nums.length; k++) {
                record('explore', `é€’å½’ depth=${idx}: è€ƒè™‘å°† nums[${k}](${nums[k]}) æ”¾åˆ°ä½ç½® ${idx}`, idx, k, nums);

                // Swap
                [nums[idx], nums[k]] = [nums[k], nums[idx]];
                record('swap', `äº¤æ¢: nums[${idx}] <-> nums[${k}]`, idx, k, nums);

                dfs(idx + 1);

                // Backtrack
                [nums[idx], nums[k]] = [nums[k], nums[idx]];
                record('backtrack', `å›æº¯: æ’¤é”€äº¤æ¢ nums[${idx}] <-> nums[${k}]`, idx, k, nums);
            }
        }

        dfs(0);
        return history;
    }

    // --- ç®—æ³• 2ï¼šæ ‡è®°æ³• (æ¨¡æ‹Ÿç”Ÿæˆå¸§) ---
    function generateVisitedFrames(arr) {
        let history = [];
        let n = arr.length;
        let visited = new Array(n).fill(false);
        let path = [];
        let collectedRes = [];

        const record = (type, msg, activeIdx) => {
            history.push({
                mode: 'visited', type, msg,
                nums: [...arr], // æºæ•°ç»„ä¸å˜
                visited: [...visited],
                path: [...path],
                activeIdx,
                results: [...collectedRes]
            });
        };

        function dfs() {
            if (path.length === n) {
                collectedRes.push([...path]);
                record('found', `è·¯å¾„é•¿åº¦è¾¾æ ‡ï¼Œæ”¶é›†: [${path.join(',')}]`, -1);
                return;
            }

            for (let i = 0; i < n; i++) {
                if (!visited[i]) {
                    visited[i] = true;
                    path.push(arr[i]);
                    record('add', `é€‰æ‹© nums[${i}](${arr[i]}) åŠ å…¥è·¯å¾„`, i);

                    dfs();

                    path.pop();
                    visited[i] = false;
                    record('backtrack', `å›æº¯: ç§»é™¤ nums[${i}](${arr[i]})`, i);
                }
            }
        }

        dfs();
        return history;
    }

    // --- æ¸²æŸ“å¼•æ“ ---
    function render(idx) {
        if (!frames[idx]) return;
        const f = frames[idx];
        const stage = document.getElementById('stage');
        stage.innerHTML = ''; // æ¸…é™¤ç”»å¸ƒ

        // æ›´æ–°æ—¥å¿—å’Œç»“æœ
        document.getElementById('logMsg').innerText = f.msg;
        document.getElementById('stepCounter').innerText = `${idx+1}/${frames.length}`;
        document.getElementById('progressBar').value = idx;

        let resHtml = 'å½“å‰ç»“æœ: ';
        f.results.forEach(r => {
            resHtml += `<span style="display:inline-block; border:1px solid #ddd; padding:2px 4px; margin:2px; border-radius:4px; background:#f9f9f9;">[${r.join(',')}]</span>`;
        });
        document.getElementById('resList').innerHTML = resHtml;

        if (f.mode === 'swap') {
            renderSwapMode(stage, f);
        } else {
            renderVisitedMode(stage, f);
        }
    }

    function renderSwapMode(stage, f) {
        const row = document.createElement('div');
        row.className = 'array-row';

        // Label
        const label = document.createElement('div');
        label.className = 'row-label';
        label.innerText = "æ•°ç»„çŠ¶æ€:";
        row.appendChild(label);

        f.nums.forEach((val, index) => {
            const node = document.createElement('div');
            node.className = 'node';
            node.innerText = val;

            const idxLbl = document.createElement('div');
            idxLbl.className = 'idx-label';
            idxLbl.innerText = index;
            node.appendChild(idxLbl);

            // æ ·å¼å¤„ç†
            // i è¡¨ç¤ºå½“å‰é€’å½’å±‚çº§ï¼Œiä¹‹å‰çš„è¡¨ç¤ºå·²å›ºå®š
            if (index < f.i) {
                node.classList.add('hl-fixed');
            }
            if (index === f.i) {
                node.classList.add('hl-pivot'); // å½“å‰å‘ä½
                // æ·»åŠ æŒ‡é’ˆæ–‡å­—
                addPointer(node, 'i (depth)', 'top');
            }
            if (index === f.j) {
                node.classList.add('hl-swap-target');
                addPointer(node, 'j (swap)', 'bottom');
            }
            if (f.type === 'found') {
                node.style.borderColor = '#22c55e';
                node.style.background = '#f0fdf4';
            }

            row.appendChild(node);
        });
        stage.appendChild(row);
    }

    function renderVisitedMode(stage, f) {
        // 1. Source Array Row (with visited status)
        const row1 = document.createElement('div');
        row1.className = 'array-row';
        const lbl1 = document.createElement('div'); lbl1.className = 'row-label'; lbl1.innerText = "èµ„æºæ± :";
        row1.appendChild(lbl1);

        f.nums.forEach((val, index) => {
            const node = document.createElement('div');
            node.className = 'node';
            node.innerText = val;

            const idxLbl = document.createElement('div');
            idxLbl.className = 'idx-label';
            idxLbl.innerText = index;
            node.appendChild(idxLbl);

            if (f.visited[index]) {
                node.classList.add('hl-used');
            }
            if (index === f.activeIdx) {
                node.style.borderColor = '#3b82f6'; // å½“å‰æ­£åœ¨æ“ä½œçš„å…ƒç´ 
            }

            row1.appendChild(node);
        });
        stage.appendChild(row1);

        // 2. Path Row
        const row2 = document.createElement('div');
        row2.className = 'array-row';
        const lbl2 = document.createElement('div'); lbl2.className = 'row-label'; lbl2.innerText = "å½“å‰è·¯å¾„:";
        row2.appendChild(lbl2);

        if (f.path.length === 0) {
            const empty = document.createElement('span');
            empty.style.color = '#ccc';
            empty.innerText = '( ç©º )';
            row2.appendChild(empty);
        } else {
            f.path.forEach((val) => {
                const node = document.createElement('div');
                node.className = 'node hl-path';
                node.innerText = val;
                row2.appendChild(node);
            });
        }
        stage.appendChild(row2);
    }

    function addPointer(parent, text, pos='top') {
        const p = document.createElement('div');
        p.style.position = 'absolute';
        p.style.fontSize = '10px';
        p.style.fontWeight = 'bold';
        p.style.color = pos==='top' ? '#f59e0b' : '#ef4444';
        p.style.width = '100px';
        p.innerText = text;
        if (pos === 'top') {
            p.style.top = '-25px';
        } else {
            p.style.bottom = '-35px';
        }
        parent.appendChild(p);
    }

    // --- æ§åˆ¶é€»è¾‘ ---
    function switchMode(m) {
        mode = m;
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${m}`).classList.add('active');
        init();
    }

    function init() {
        stopPlay();
        const val = document.getElementById('arrInput').value;
        const arr = val.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));

        if (arr.length > 5) {
            alert('ä¸ºäº†æ¼”ç¤ºæµç•…ï¼Œå»ºè®®æ•°ç»„é•¿åº¦ <= 5');
            return;
        }

        if (mode === 'swap') {
            frames = generateSwapFrames(arr);
        } else {
            frames = generateVisitedFrames(arr);
        }

        document.getElementById('progressBar').max = Math.max(0, frames.length - 1);
        curIdx = 0;
        render(0);
    }

    function step(d) {
        let next = curIdx + d;
        if (next >= 0 && next < frames.length) {
            curIdx = next;
            render(curIdx);
        } else {
            stopPlay();
        }
    }

    function scrub(v) {
        stopPlay();
        curIdx = parseInt(v);
        render(curIdx);
    }

    function togglePlay() {
        if (isPlaying) stopPlay();
        else {
            isPlaying = true;
            document.getElementById('btnPlay').innerText = 'â¸';
            if (curIdx === frames.length - 1) curIdx = 0;
            timer = setInterval(() => step(1), 600);
        }
    }

    function stopPlay() {
        isPlaying = false;
        document.getElementById('btnPlay').innerText = 'â¯';
        clearInterval(timer);
    }

    window.onload = () => {
        init();
    };

</script>
</body>
</html>
